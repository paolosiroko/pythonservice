# Python  Service
This  Python service project developed using  Django REST Framework with Postgres database  enables the creation of customers, each defined by fields such as name and code. Additionally, it supports the creation of orders for specific customers, incorporating various inputs like item, amount, and time. Upon order creation, the customer receives an alert via SMS,through Africa’s Talking SMS gateway and sandbox.

The service includes  authorization and authentication mechanisms using OAuth2 and OpenID Connect for every incoming request. Furthermore, the project is equipped with various unit tests and follows a continuous integration and continuous deployment (CI/CD) pipeline. The deployed version of the project is accessible on Render.
# How to Setup
1. Clone Project
```
git clone https://github.com/paolosiroko/pythonservice.git
```

2. Go To Project Directory
```
cd pythonservice
```
3. Create Virtual Environment
```
python3 -m venv venv
```
4. Active Virtual Environment
```
source venv/bin/activate
```
5. Install Requirements File
```
pip install -r requirements.txt
```
6. Migrate Database
```
python manage.py makemigrations
python manage.py migrate
```
7. Create Super User
```
python manage.py createsuperuser
```
8. Run Project
```
python manage.py runserver
```
### NB
Create .env file inside main project directory and add your environment variables like `SECRET_KEY` `DEBUG`. For Postgres DB add database configurations like   `DB_NAME` `DB_USER` `DB_PASSWORD` `DB_PORT` `DB_HOST`. 
For Africa Stalking SMS gateway, add `USER_NAME` and `API_KEY`.

# API Documentation
Once you successfully run the application and having created superuser. 
### Getting  Access_Token
To obtain an OAuth2 token, you must register an application. To register an application got to the Django admin in the browser and login using the superuser credentials created earlier.
Then send a GET request to the api endpoint or open it on browser
```
{url}/o/applications/
```
register a new app. It will take you to a form, fill it, replace your client id and secret, if they are values in it.

Save it and Now you have created an app for OAuth. And it’s time for generating your OAuth token.

## Generating an Access_Token
To obtain an access token send POST request to the API endpoint below
```
{url}/o/token/
```
add to the 
`Basic Authorisation Headers`: Username as the `Client id` of the app you just registered, and the password will be `Client secret`

`Request Body`: We will have to pass parameters username, password and grant_type in the request body. Here, I’m using the form-data method to pass the body. Username and Password are the credentials for the superuser.Grant_type is from the register authentication app.

Once you call this API with exact credentials, you will get response with an OAuth access token like below

```
{
    "access_token": "<your_access_token>",
    "token_type": "Bearer",
    "expires_in": 36000,
    "refresh_token": "<your_refresh_token>",
    "scope": "read write groups"
}
```

## Accessing Protected API Endpoints
We have different endpoints for adding Customer and Order. The endpoints requires authetications.
To GET/POST customer endpoint use the url below.
```
{url}/api/customer/
```
For Order use 
```
{url}/api/order/
```
To add/view  customer add `Access_token` received in the `Bearer Token Authorisation Headers`:

Then add to the body add data the the various fields `name`,`code`,`phone_number`.


Same to order add the fields `customer`,`item`,`amount`. For Customer use customer_id that is autogenerated for each customer.

## Africa’s Talking SMS gateway
You should have account on [Africa's Talking Portal](https://africastalking.com/). Go to sandbox, and generate API Key, that we will be for sending the sms.
Launch the simulator and connect with phone number used when adding a Customer, for testing purposes.
When order is made using order api endpoint provided above asample message  should be sent to the simulator.


## Deployed Version on Render
I have deployed the python service on [Render.com](https://dashboard.render.com/) connected with Postgres database from Render.

```
https://pythonservice.onrender.com
```
Test the python service by adding  this url to the above endpoints using the API Documentation section.
For superuser credentials use admin for both  password and username.

## Unit tests
I have added unit tests in the `tests` folder. To perform the coverage unit testing run the command below in the terminal

```
 pip install coverage
 coverage run -m pytest
 coverage report -m
```
If you have  failed tests due to unaithorised access to the api urls,go to the test files under `Include OAuth2 authentication headers` and add your `Access Token`

## CI/CD Workflow
The CI/CD workflows are in the .github/workflows folder.
